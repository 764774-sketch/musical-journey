<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç”Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ </title>
    

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans JP', sans-serif; /* æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã‚’å„ªå…ˆ */
            /* èƒŒæ™¯ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èª¿æ•´ */
            background: linear-gradient(135deg, #fce3e7 0%, #e0f2f7 100%); 
            color: #333;
            margin: 0;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        #game-container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 20px; /* è§’ã‚’ä¸¸ã */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15); /* ã‚ˆã‚Šæ·±ã„å½± */
            max-width: 850px; /* å°‘ã—åºƒã’ã‚‹ */
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.8); /* è»½ã„ãƒœãƒ¼ãƒ€ãƒ¼ */
        }
        h1, h2 {
            color: #d81b60; /* ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’é®®ã‚„ã‹ãªãƒ”ãƒ³ã‚¯ã« */
            text-align: center;
            margin-bottom: 25px;
            font-weight: 700;
        }
        #status {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            margin-bottom: 30px;
            border: none;
            border-radius: 15px;
            background: linear-gradient(45deg, #ffdde1 0%, #fcdada 100%); /* æš–è‰²ç³»ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        .status-item {
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            color: #555;
            display: flex; /* ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¨ªä¸¦ã³ã« */
            align-items: center; /* ä¸­å¤®æƒãˆ */
            gap: 8px; /* ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ†ã‚­ã‚¹ãƒˆã®é–“éš” */
        }
        .status-item span {
            display: inline-block; /* ã‚¢ã‚¤ã‚³ãƒ³ã¨æ¨ªä¸¦ã³ã«ã™ã‚‹ãŸã‚ */
            font-size: 1.6em;
            color: #d93025; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯èµ¤ */
            margin-left: 5px;
        }
        .status-item i { /* Font Awesomeã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
            font-size: 1.4em;
            color: #d81b60; /* ã‚¢ã‚¤ã‚³ãƒ³ã®è‰² */
        }
        #happiness-value { color: #f9ab00; } /* å¹¸ç¦åº¦ã¯ã‚ªãƒ¬ãƒ³ã‚¸ */
        #money-value.positive { color: #1e8e3e; } /* ãŠé‡‘ãƒ—ãƒ©ã‚¹ã¯ç·‘ */
        #money-value.negative { color: #d93025; } /* ãŠé‡‘ãƒã‚¤ãƒŠã‚¹ã¯èµ¤ */

        #term-info {
            background-color: #fcfcfc;
            padding: 25px;
            border-radius: 12px;
            border-left: 6px solid #d81b60; /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ã«åˆã‚ã›ã‚‹ */
            margin-bottom: 30px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        #term-title {
            font-size: 2em;
            margin-bottom: 8px;
            color: #d81b60;
        }
        #age-text {
            font-size: 1.2em;
            color: #777;
            margin-bottom: 15px;
        }
        #term-description {
            line-height: 1.8;
            font-size: 1.1em;
            color: #444;
        }
        #term-image {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 18px; /* é–“éš”ã‚’åºƒã’ã‚‹ */
            margin-top: 30px;
        }
        .choice-button {
            background-color: #26c6da; /* é®®ã‚„ã‹ãªã‚·ã‚¢ãƒ³ãƒ–ãƒ«ãƒ¼ */
            color: white;
            border: none;
            padding: 18px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¢—ã‚„ã™ */
            border-radius: 10px; /* è§’ã‚’ä¸¸ã */
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
            text-align: left;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .choice-button:hover {
            background-color: #00bcd4; /* ãƒ›ãƒãƒ¼ã§å°‘ã—æš—ã */
            transform: translateY(-2px); /* å°‘ã—æµ®ãä¸ŠãŒã‚‹ */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        .choice-button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .choice-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #result-panel {
            background-color: #e8f5e9; /* çµæœãƒ‘ãƒãƒ«ã¯è–„ã„ç·‘è‰² */
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #a5d6a7;
            margin-top: 30px;
            display: none;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        #result-panel h3 {
            color: #388e3c; /* çµæœã‚¿ã‚¤ãƒˆãƒ«ã®è‰² */
            margin-bottom: 15px;
        }
        #result-text {
            line-height: 1.6;
        }
        .log-detail {
            margin-top: 15px;
            padding-left: 15px;
            border-left: 4px solid #388e3c; /* çµæœãƒ‘ãƒãƒ«ã«åˆã‚ã›ã‚‹ */
            color: #333;
            font-size: 1.05em;
        }
        #next-button {
            background-color: #4CAF50; /* ç·‘ */
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.3em;
            margin-top: 30px;
            width: 100%;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        #next-button:hover {
            background-color: #388E3C; /* ãƒ›ãƒãƒ¼ã§å°‘ã—æš—ã */
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        #next-button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        /* çµ‚äº†ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #end-game-screen {
            background-color: #fff3e0; /* çµ‚äº†ç”»é¢ã¯è–„ã„ã‚ªãƒ¬ãƒ³ã‚¸ */
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            display: none;
            margin-top: 30px;
        }
        #end-game-screen h2 {
            color: #ff9800; /* ã‚ªãƒ¬ãƒ³ã‚¸è‰²ã®è¦‹å‡ºã— */
            font-size: 2.5em;
        }
        .final-result-item {
            font-size: 1.4em;
            margin: 15px 0;
            color: #444;
        }
        .final-result-item span {
            font-weight: bold;
            color: #d81b60;
            font-size: 1.2em;
        }
        #rating {
            font-size: 1.8em;
            font-weight: bold;
            margin: 25px 0;
            padding: 15px;
            border: 3px dashed #ff9800;
            display: inline-block;
            color: #d81b60;
        }
        #total-score { /* ã‚¹ã‚³ã‚¢è¡¨ç¤ºç”¨ã®æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ« */
            font-size: 1.6em;
            margin: 15px 0 25px;
            color: #26c6da;
            font-weight: bold;
        }

        /* è² å‚µãƒ»å®¶è³ƒã®å ±å‘Šãƒ‘ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        .repayment-warning {
            color: #333; 
            font-weight: normal;
            font-size: 1.1em;
            padding: 20px;
            background-color: #ffe0b2; /* è–„ã„ã‚ªãƒ¬ãƒ³ã‚¸ */
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #ffb74d;
        }
        .repayment-warning h3 {
            color: #e65100; /* æ¿ƒã„ã‚ªãƒ¬ãƒ³ã‚¸ */
            margin-top: 0;
        }
        .repayment-warning .final-status {
            font-size: 1.2em;
            margin-top: 10px;
        }
        
        /* ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆå ±å‘Šãƒ‘ãƒãƒ« */
        .random-event-report {
            color: #333;
            font-weight: normal;
            font-size: 1.1em;
            padding: 20px;
            background-color: #fce4ec; /* è–„ã„ãƒ”ãƒ³ã‚¯ */
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #f48fb1;
        }
        .random-event-report h3 {
            color: #d81b60; /* æ¿ƒã„ãƒ”ãƒ³ã‚¯ */
            margin-top: 0;
        }

        /* æ–°è¦è¿½åŠ : ãƒšãƒŠãƒ«ãƒ†ã‚£å ±å‘Šãƒ‘ãƒãƒ« */
        .penalty-report {
            color: #333;
            font-weight: normal;
            font-size: 1.1em;
            padding: 20px;
            background-color: #ffcdd2; /* è–„ã„èµ¤ */
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #e57373;
        }
        .penalty-report h3 {
            color: #c62828; /* æ¿ƒã„èµ¤ */
            margin-top: 0;
        }
    </style>
</head>
<body>

<div id="game-container">
    <h1>äººç”Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒ </h1>

    <div id="status">
        <div class="status-item"><i class="fas fa-calendar-alt"></i> ã‚¿ãƒ¼ãƒ : <span id="term-value">1</span></div>
        <div class="status-item"><i class="fas fa-user-circle"></i> å¹´é½¢: <span id="age-value">22</span></div>
        <div class="status-item"><i class="fas fa-yen-sign"></i> ãŠé‡‘ (ä¸‡å††): <span id="money-value">1000</span></div>
        <div class="status-item"><i class="fas fa-heart"></i> å¹¸ç¦åº¦: <span id="happiness-value">200</span></div>
    </div>
    
    <div id="term-info">
        <div class="penalty-report" id="status-penalty-report" style="display:none;">
            </div>
        <div class="repayment-warning" id="mandatory-payment-report" style="display:none;">
            </div>
        <div class="random-event-report" id="random-career-event" style="display:none;">
            </div>
        <div class="random-event-report" id="random-business-school-result" style="display:none;">
            </div>


        <div id="term-title"></div>
        <div id="age-text"></div>
        <div id="term-description"></div>
        <img id="term-image" style="display:none;">
    </div>
    
    <div id="choices-container">
        </div>

    <div id="result-panel">
        <h3>çµæœç™ºè¡¨</h3>
        <div id="result-text"></div>
    </div>
    
    <button id="next-button" style="display:none;">æ¬¡ã¸é€²ã‚€</button>

    <div id="log-section">
        <h3>äººç”Ÿã®è¨˜éŒ²</h3>
        <ul id="log-list"></ul>
    </div>
    
</div>

<div id="end-game-screen">
    <h2>äººç”Ÿçµ‚äº†</h2>
    <div class="final-result-item">æœ€çµ‚è³‡ç”£: <span id="final-money"></span> ä¸‡å††</div>
    <div class="final-result-item">æœ€çµ‚å¹¸ç¦åº¦: <span id="final-happiness"></span> pt</div>
    <div id="total-score">ç·åˆã‚¹ã‚³ã‚¢: <span id="final-score"></span></div>
    <div id="rating"></div>
</div>

<script>
// ----------------------------------------------------
// 1. ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã¨å®šæ•°
// ----------------------------------------------------

let gameData = {
    term: 1,
    age: 22,
    money: 1000, // åˆæœŸè³‡ç”£ (ä¸‡å††)
    happiness: 200, 
    jobType: 'None',
    isRetired: false,
    hasInsurance: false, 
    isRenting: false, 
    log: [],
    // çµå©šçŠ¶æ…‹ã‚’è¿½è·¡
    isMarried: false 
};

// è·ç¨®ã”ã¨ã®åŸºæœ¬åå…¥ã‚’å®šæ•°åŒ– (ä¸‡å††/4å¹´)
const JOB_INCOME = {
    'Public': 150,
    'Private': 200,
    'Retired': 60, // å¹´é‡‘
    'None': 0
};

// ã‚¿ãƒ¼ãƒ æƒ…å ± (å…¨15ã‚¿ãƒ¼ãƒ )
const terms = [
    // 1ã‚¿ãƒ¼ãƒ : å°±è· (22-25æ­³)
    {
        startAge: 22,
        description: "å¤§å­¦ã‚’å’æ¥­ã—ã€ã„ã‚ˆã„ã‚ˆç¤¾ä¼šäººã§ã™ã€‚ã©ã®é“ã«é€²ã¿ã¾ã™ã‹ï¼Ÿ",
        image: 'æ–°ç¤¾ä¼šäºº.png', 
        choices: {
            A: {
                text: "å®‰å®šã—ãŸå…¬å‹™å“¡ã«ãªã‚‹ (åˆæœŸåå…¥é«˜, å¹¸ç¦åº¦å®‰å®š)",
                logText: "å®‰å®šã—ãŸå…¬å‹™å“¡ã«ãªã‚Šã¾ã—ãŸã€‚ç¢ºå®Ÿãªæœªæ¥ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ãŸã€‚",
                money: 150, 
                happiness: 15, 
                type: 'job',
                jobType: 'Public'
            },
            B: {
                text: "æˆæœä¸»ç¾©ã®å¤–è³‡ç³»ä¼æ¥­ã«å…¥ã‚‹ (åˆæœŸåå…¥ä½, å¹¸ç¦åº¦å¤‰å‹•å¤§)",
                logText: "ãƒªã‚¹ã‚¯ã‚’å–ã£ã¦å¤–è³‡ç³»ä¼æ¥­ã«å…¥ç¤¾ã€‚å®ŸåŠ›æ¬¡ç¬¬ã®æŒ‘æˆ¦ã®æ—¥ã€…ãŒå§‹ã¾ã‚Šã¾ã™ã€‚",
                money: 50, 
                happiness: 25, 
                type: 'job',
                jobType: 'Private'
            }
        }
    },
    // 2ã‚¿ãƒ¼ãƒ : ä»•äº‹ã®é¸æŠ (26-29æ­³)
    {
        startAge: 26,
        description: "ä»•äº‹ã«æ…£ã‚Œã¦ããŸé ƒã€å¤§ããªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒèˆã„è¾¼ã¿ã¾ã—ãŸã€‚æŒ‘æˆ¦ã¨å®‰å®šã€ã©ã¡ã‚‰ã‚’é¸ã³ã¾ã™ã‹ï¼Ÿ",
        image: 'æ–°ç¤¾ä¼šäºº.png', 
        choices: {
            A: {
                text: "æ®‹æ¥­ã‚’å­ã‚ãšã€å‡ºä¸–ã‚’ç›®æŒ‡ã™ (åå…¥â†‘, å¹¸ç¦åº¦â†“â†“)",
                logText: "ã²ãŸã™ã‚‰åƒãã€å‡ºä¸–ã®éšæ®µã‚’ç™»ã‚Šå§‹ã‚ã¾ã—ãŸã€‚",
                money: 150, 
                happiness: -30, 
            },
            B: {
                text: "å®šæ™‚ã§å¸°ã‚Šã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚’å……å®Ÿã•ã›ã‚‹ (åå…¥â†“, å¹¸ç¦åº¦â†‘)",
                logText: "ä»•äº‹ã‚ˆã‚Šã‚‚è‡ªåˆ†ã®æ™‚é–“ã‚’å¤§åˆ‡ã«ã—ã€å¿ƒèº«ã¨ã‚‚ã«å¥åº·ãªæ—¥ã€…ã‚’éã”ã—ã¦ã„ã¾ã™ã€‚",
                money: 50, 
                happiness: 40, 
            }
        }
    },
    // 3ã‚¿ãƒ¼ãƒ : ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ— (30-33æ­³)
    {
        startAge: 30,
        description: "30æ­³ã«ãªã‚Šã€å°†æ¥ã¸ã®å±æ©Ÿæ„Ÿã‚’æ„Ÿã˜å§‹ã‚ã¾ã—ãŸã€‚è‡ªå·±æŠ•è³‡ã‚’è¡Œã„ã¾ã™ã‹ï¼Ÿ",
        image: 'ä¸­å¹´ç”·å¥³.png', 
        choices: {
            A: {
                text: "é«˜é¡ãªãƒ“ã‚¸ãƒã‚¹ã‚¹ã‚¯ãƒ¼ãƒ«ã«é€šã† (å‡ºè²»å¤§, ä½ç¢ºç‡ã§åå…¥å¤§å¹…ã‚¢ãƒƒãƒ—)",
                logText: "ãƒ“ã‚¸ãƒã‚¹ã‚¹ã‚¯ãƒ¼ãƒ«ã«å¤šé¡ã®æŠ•è³‡ã‚’è¡Œã„ã¾ã—ãŸã€‚ã“ã‚ŒãŒå°†æ¥ã«æ´»ãã‚‹ã‹â€¦",
                money: -150, 
                happiness: 25, 
                type: 'businessSchool' 
            },
            B: {
                text: "è¶£å‘³ã«æ²¡é ­ã—ã€ä»•äº‹ã®ã‚¹ãƒˆãƒ¬ã‚¹ã‚’ç™ºæ•£ã™ã‚‹ (å‡ºè²»å°, å¹¸ç¦åº¦ã‚¢ãƒƒãƒ—)",
                logText: "é€±æœ«ã¯è¶£å‘³ã«æ‰“ã¡è¾¼ã¿ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã€‚æ—¥ã€…ã®å¹¸ç¦åº¦ãŒé«˜ã¾ã‚Šã¾ã—ãŸã€‚",
                money: -30, 
                happiness: 35, 
            }
        }
    },
    // 4ã‚¿ãƒ¼ãƒ : æ–°ã—ã„æŒ‘æˆ¦ (34-37æ­³)
    {
        startAge: 34,
        description: "ã‚­ãƒ£ãƒªã‚¢ã®å²è·¯ã«ç«‹ã¡ã¾ã—ãŸã€‚ã“ã®ã¾ã¾ä»Šã®ä»•äº‹ã‚’ç¶šã‘ã‚‹ã‹ã€ã‚ã‚‹ã„ã¯ãƒªã‚¹ã‚¯ã‚’å†’ã—ã¦è»¢è·ã™ã‚‹ã‹ï¼Ÿ",
        image: 'ä¸­å¹´ç¤¾ä¼šäºº.png', 
        choices: {
            A: {
                text: "é«˜åå…¥ã ãŒæ¿€å‹™ãªç•°æ¥­ç¨®ã«è»¢è·ã™ã‚‹ (ãŠé‡‘â†‘â†‘, å¹¸ç¦åº¦â†“â†“)",
                logText: "æ¿€å‹™è¦šæ‚Ÿã§ç•°æ¥­ç¨®ã¸è»¢è·ã€‚çµ¦æ–™ã¯ä¸ŠãŒã‚Šã¾ã—ãŸãŒã€ç”Ÿæ´»ã¯ä¸€å¤‰ã—ã¾ã—ãŸã€‚",
                money: 250, 
                happiness: -60, 
            },
            B: {
                text: "ä»Šã®è·å ´ã§å®‰å®šã‚’ç›®æŒ‡ã™ (ãŠé‡‘Â±0, å¹¸ç¦åº¦Â±0)",
                logText: "ç¾çŠ¶ç¶­æŒã‚’é¸æŠã€‚å®‰å®šã—ãŸç”Ÿæ´»ã¯ç¶šãã¾ã™ãŒã€å¤§ããªå¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
                money: 0,
                happiness: 0,
            }
        }
    },
    // 5ã‚¿ãƒ¼ãƒ : ä¿é™ºã®æ¤œè¨ (38-41æ­³)
    {
        startAge: 38,
        description: "å°†æ¥ã®å‚™ãˆã¨ã—ã¦ã€ä¿é™ºä¼šç¤¾ã‹ã‚‰é«˜é¡ãªç·åˆä¿é™ºã®æ¡ˆå†…ãŒå±Šãã¾ã—ãŸã€‚åŠ å…¥ã™ã‚Œã°å®‰å¿ƒã§ã™ãŒã€ã¾ã¨ã¾ã£ãŸå‡ºè²»ã«ãªã‚Šã¾ã™ã€‚",
        image: 'ä¸­å¹´ç¤¾ä¼šäºº.png', 
        choices: {
            A: {
                text: "å¹´é–“100ä¸‡å††ã‚’æ‰•ã„è¾¼ã¿ã€ç·åˆä¿é™ºã«åŠ å…¥ã™ã‚‹ã€‚",
                logText: "å°†æ¥ã®ä¸å®‰ã«å‚™ãˆã€ç·åˆä¿é™ºã«åŠ å…¥ã—ã¾ã—ãŸã€‚ã“ã‚Œã§ä¸‡ãŒä¸€ã®ã¨ãã‚‚å®‰å¿ƒã§ã™ã€‚",
                money: -100, 
                happiness: 10, 
                type: 'insurance' 
            },
            B: {
                text: "ä¿é™ºã¯ä¸è¦ã€‚ãã®åˆ†ã€è‡ªç”±ãªè³‡é‡‘ã¨ã—ã¦æ‰‹å…ƒã«ç½®ã„ã¦ãŠãã€‚",
                logText: "ä¿é™ºã«ã¯åŠ å…¥ã›ãšã€æ‰‹å…ƒã®è³‡é‡‘ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚å‚™ãˆã‚ˆã‚Šã‚‚è‡ªç”±ã‚’å„ªå…ˆã—ã¾ã™ã€‚",
                money: 0,
                happiness: 0
            }
        }
    },
    // 6ã‚¿ãƒ¼ãƒ : äººç”Ÿã®ä¼´ä¾¶ (42-45æ­³)
    {
        startAge: 42,
        description: "å°†æ¥ã‚’å…±ã«ã™ã‚‹ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã«ã¤ã„ã¦è€ƒãˆã¾ã™ã€‚çµå©šã—ã¦å®¶æ—ã‚’æŒã¤ã‹ã€ç‹¬èº«ã‚’è²«ãã‹ï¼Ÿ",
        image: 'ä¸­å¹´ç”·å¥³.png', 
        choices: {
            A: {
                text: "çµå©šã—ã€å…±ã«ç”Ÿæ´»ã‚’å§‹ã‚ã‚‹ (å‡ºè²»â†‘, å¹¸ç¦åº¦â†‘â†‘)",
                logText: "çµå©šã—ã€äººç”Ÿã®ä¼´ä¾¶ã‚’å¾—ã¾ã—ãŸã€‚å¤§ããªå¹¸ç¦æ„ŸãŒå¾—ã‚‰ã‚Œã¾ã—ãŸã€‚",
                money: -150, 
                happiness: 100, 
                type: 'marry'
            },
            B: {
                text: "ç‹¬èº«ã‚’è²«ã (ãŠé‡‘Â±0, å¹¸ç¦åº¦Â±0)",
                logText: "ç‹¬èº«ã‚’è²«ãã“ã¨ã‚’é¸æŠã€‚è‡ªç”±ãªç”Ÿæ´»ã‚’æ¥½ã—ã¿ã¾ã™ã€‚",
                money: 0,
                happiness: 0,
            }
        }
    },
    // 7ã‚¿ãƒ¼ãƒ : ä½å±…ã®é¸æŠ (46-49æ­³)
    {
        startAge: 46,
        description: "ç”Ÿæ´»ã®åŸºç›¤ã¨ãªã‚‹ä½å±…ã‚’é¸ã³ã¾ã™ã€‚æŒã¡å®¶ã‹ã€ãã‚Œã¨ã‚‚èº«è»½ãªè³ƒè²¸ã‹ï¼Ÿ",
        image: 'ä¸­å¹´ç”·å¥³.png', 
        choices: {
            A: {
                text: "éƒŠå¤–ã«åºƒã„ä¸€è»’å®¶ã‚’è³¼å…¥ã™ã‚‹ (å‡ºè²»å¤§, å¹¸ç¦åº¦â†‘â†‘â†‘)",
                logText: "éƒŠå¤–ã«å¤¢ã®ä¸€è»’å®¶ã‚’è³¼å…¥ã€‚äººç”Ÿã§æœ€å¤§ã®è²·ã„ç‰©ãŒã€å¿ƒã®æº€è¶³æ„Ÿã‚’ã‚‚ãŸã‚‰ã—ã¾ã—ãŸã€‚",
                money: -2000, 
                happiness: 200, 
                type: 'housing',
                housingStatus: 'own' 
            },
            B: {
                text: "è³ƒè²¸ã«ä½ã¿ç¶šã‘ã€è‡ªç”±ã«ç”Ÿãã‚‹ (æ¯ã‚¿ãƒ¼ãƒ å®¶è³ƒ-70ä¸‡å††)",
                logText: "è³ƒè²¸ã‚’é¸ã³ã€èº«è»½ãªç”Ÿæ´»ã‚’ç¶­æŒã€‚æ¯ã‚¿ãƒ¼ãƒ å®¶è³ƒã®å‡ºè²»ãŒç™ºç”Ÿã—ã¾ã™ã€‚",
                money: 0,
                happiness: 0,
                type: 'housing',
                housingStatus: 'rent' 
            }
        }
    },
    // 8ã‚¿ãƒ¼ãƒ : å­ä¾›ã®æ•™è‚² / ç‹¬èº«è€…ã®è‡ªå·±æŠ•è³‡ (50-53æ­³)
    {
        startAge: 50,
        description: "ã‚‚ã—çµå©šã—ã¦ã„ã‚Œã°ã€å­ä¾›ã®æ•™è‚²è²»ã®ãƒ”ãƒ¼ã‚¯ã§ã™ã€‚æ•™è‚²ã«ã©ã“ã¾ã§ãŠé‡‘ã‚’ã‹ã‘ã¾ã™ã‹ï¼Ÿ",
        image: 'ä¸­å¹´ç”·å¥³.png', 
        choices: { // æ—¢å©šè€…ï¼ˆå­æŒã¡ï¼‰å‘ã‘ã‚’æƒ³å®š
            A: {
                text: "å…¨ã¦ã‚’æƒœã—ã¿ãªãæ•™è‚²ã«æŠ•è³‡ã™ã‚‹ (å‡ºè²»å¤§, ä½ç¢ºç‡ã§åå…¥å¤§å¹…ã‚¢ãƒƒãƒ—)",
                logText: "å­ä¾›ã®å°†æ¥ã®ãŸã‚ã€ç§ç«‹å­¦æ ¡ã‚„å¡¾ã«å¤šé¡ã®è²»ç”¨ã‚’æŠ•ã˜ã¾ã—ãŸã€‚",
                money: -1000, 
                happiness: 40, 
                type: 'educationInvest' 
            },
            B: {
                text: "ç„¡ç†ã®ãªã„ç¯„å›²ã§å…¬ç«‹ã‚’é¸ã¶ (ãŠé‡‘Â±0, å¹¸ç¦åº¦Â±0)",
                logText: "å…¬ç«‹ã‚’é¸ã³ã€å …å®Ÿãªæ•™è‚²æ–¹é‡ã‚’è²«ãã¾ã—ãŸã€‚",
                money: 0,
                happiness: 0,
            }
        },
        singleChoices: { // ç‹¬èº«è€…å‘ã‘
            A: {
                text: "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢å›£ä½“ã«ç†±å¿ƒã«å‚åŠ ã™ã‚‹ (å‡ºè²»â†“, å¹¸ç¦åº¦â†‘â†‘)",
                logText: "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢æ´»å‹•ã«æ²¡é ­ã—ã€ç¤¾ä¼šã¨ã®ç¹‹ãŒã‚Šã¨å¤§ããªå¹¸ç¦æ„Ÿã‚’å¾—ã¾ã—ãŸã€‚",
                money: -100,
                happiness: 80,
            },
            B: {
                text: "é«˜é¡ãªãƒšãƒƒãƒˆã‚’é£¼ã„ã€æ™‚é–“ã‚’è²»ã‚„ã™ (å‡ºè²»â†‘â†‘, å¹¸ç¦åº¦â†‘)",
                logText: "é«˜é¡ãªãƒšãƒƒãƒˆã‚’é£¼ã„å§‹ã‚ã¾ã—ãŸã€‚ç™’ã—ã‚’å¾—ã‚‰ã‚Œã¾ã—ãŸãŒã€ãã®å¾Œã®ä¸–è©±ã¨è²»ç”¨ã‚‚ã‹ã‹ã‚Šã¾ã™ã€‚",
                money: -200,
                happiness: 75, 
            }
        }
    },
    // 9ã‚¿ãƒ¼ãƒ : å¥åº·è¨ºæ–­ (54-57æ­³)
    {
        startAge: 54,
        description: "å¹´ã«ä¸€åº¦ã®å¥åº·è¨ºæ–­ã§ã€åŒ»è€…ã‹ã‚‰ç”Ÿæ´»ç¿’æ…£ã®æ”¹å–„ã‚’å‹§ã‚ã‚‰ã‚Œã¾ã—ãŸã€‚ã©ã†ã—ã¾ã™ã‹ï¼Ÿ",
        image: 'ä¸­å¹´ç”·å¥³.png', 
        choices: {
            A: {
                text: "ã™ãã«ç”Ÿæ´»ç¿’æ…£ã‚’æ”¹å–„ã—ã€é‹å‹•ã‚’å§‹ã‚ã‚‹ (ãŠé‡‘â†“, å¹¸ç¦åº¦â†‘)",
                logText: "å¥åº·çš„ãªé£Ÿç”Ÿæ´»ã¨é‹å‹•ã‚’é–‹å§‹ï¼ä½“ãŒè»½ããªã‚Šã€å¹¸ç¦åº¦ã‚‚ä¸ŠãŒã‚Šã¾ã—ãŸã€‚",
                money: -50, 
                happiness: 45, 
            },
            B: {
                text: "ç‰¹ã«æ°—ã«ã›ãšã€ä»Šã¾ã§é€šã‚Šéã”ã™ (ãŠé‡‘Â±0, å¹¸ç¦åº¦â†“)",
                logText: "åŒ»è€…ã®å¿ å‘Šã‚’ç„¡è¦–ã€‚ç‰¹ã«å¤‰åŒ–ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€å°†æ¥ã®ä¸å®‰ãŒå°‘ã—æ®‹ã‚Šã¾ã™ã€‚",
                money: 0,
                happiness: -10, 
            }
        }
    },
    // 10ã‚¿ãƒ¼ãƒ : æ—©æœŸé€€è·ã®èª˜ã„ (58-61æ­³)
    {
        startAge: 58,
        description: "ä¼šç¤¾ã‹ã‚‰æ—©æœŸé€€è·ã®å„ªé‡ãƒ—ãƒ©ãƒ³ãŒæç¤ºã•ã‚Œã¾ã—ãŸã€‚ãƒªã‚¿ã‚¤ã‚¢ã™ã‚‹ã‹ã€åƒãç¶šã‘ã¾ã™ã‹ï¼Ÿ",
        image: 'ä¸­å¹´ç”·å¥³.png', 
        choices: {
            A: {
                text: "æ—©æœŸé€€è·ã—ã€ç¬¬äºŒã®äººç”Ÿã‚’è¬³æ­Œã™ã‚‹ (åå…¥â†“, å¹¸ç¦åº¦â†‘â†‘) - é€€è·é‡‘ãƒœãƒ¼ãƒŠã‚¹300ä¸‡å††ã€‚",
                logText: "æ—©æœŸé€€è·ã‚’æ±ºæ–­ã€‚è‡ªç”±ãªæ™‚é–“ã‚’æ‰‹ã«å…¥ã‚Œã€äººç”Ÿã®å¹¸ç¦åº¦ãŒå¤§å¹…ã«ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚",
                money: 300, 
                happiness: 80, 
                type: 'retire'
            },
            B: {
                text: "å®šå¹´ã¾ã§åƒãã€åå…¥æºã‚’ç¢ºä¿ã™ã‚‹ (åå…¥â†‘, å¹¸ç¦åº¦Â±0)",
                logText: "å®šå¹´ã¾ã§åƒãç¶šã‘ã‚‹ã“ã¨ã‚’é¸æŠã€‚å®‰å®šã—ãŸåå…¥æºã‚’ç¶­æŒã—ã¾ã™ã€‚",
                money: 0,
                happiness: 0,
            }
        }
    },
    // 11ã‚¿ãƒ¼ãƒ : ä¸æ…®ã®äº‹æ•… (62-65æ­³)
    {
        startAge: 62,
        description: "ä¸æ…®ã®äº‹æ•…ã«å·»ãè¾¼ã¾ã‚Œã¾ã—ãŸã€‚æ€ªæˆ‘ã®æ²»ç™‚ã¨ã€ç›¸æ‰‹ã¸ã®è£œå„ŸãŒå¿…è¦ã§ã™ã€‚",
        image: 'è€å¾Œ.png', 
        choices: {
            A: {
                text: "äº‹æ•…ã®æå®³ã‚’å…¨ã¦å—ã‘å…¥ã‚Œã‚‹ã€‚", 
                logText: "äº‹æ•…ã®æå®³ã‚’å—ã‘å…¥ã‚Œã¾ã™...",
                money: -1500, 
                happiness: -60, 
                type: 'accident'
            },
            B: {
                text: "ä¿é™ºä¼šç¤¾ã«å…¨ã¦ä»»ã›ã‚‹ (ä¿é™ºåŠ å…¥è€…ã®ã¿é¸æŠå¯)ã€‚",
                logText: "ä¿é™ºã®é©ç”¨ã«ã‚ˆã‚Šã€é‡‘éŠ­çš„æå®³ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‰ã‚Œã¾ã—ãŸã€‚",
                money: -150, // æ‰‹æ•°æ–™
                happiness: -15, 
                required: 'hasInsurance' 
            },
            C: {
                text: "é«˜é¡ãªå¼è­·å£«è²»ç”¨ã‚’æ‰•ã„ã€ç›¸æ‰‹ã¨ã®äº¤æ¸‰ã‚’å°‚é–€å®¶ã«ä»»ã›ã‚‹ (éä¿é™ºè€…ç”¨)ã€‚",
                logText: "å°‚é–€å®¶ã«äº¤æ¸‰ã‚’ä¾é ¼ã€‚é‡‘éŠ­çš„æå®³ã¯å¤§ãã‹ã£ãŸã‚‚ã®ã®ã€ç²¾ç¥çš„è² æ‹…ã¯æ¸›ã‚Šã¾ã—ãŸã€‚",
                money: -500, 
                happiness: -30, 
                required: '!hasInsurance' 
            }
        }
    },
    // 12ã‚¿ãƒ¼ãƒ : æŠ•è³‡ (66-69æ­³)
    {
        startAge: 66,
        description: "æ‰‹å…ƒã®è³‡é‡‘ãŒæ½¤æ²¢ã«ãªã‚Šã¾ã—ãŸã€‚ãƒªã‚¹ã‚¯ã‚’è¦šæ‚Ÿã§å¤§ããªæŠ•è³‡ã‚’è¡Œã„ã¾ã™ã‹ï¼Ÿ",
        image: 'è€å¾Œ.png', 
        choices: {
            A: {
                text: "å…¨è²¡ç”£ã®åŠåˆ†ã‚’ãƒªã‚¹ã‚¯æŠ•è³‡ã«å›ã™ (ãŠé‡‘å¤§å¹…å¤‰å‹•)",
                logText: "è€å¾Œã®è³‡é‡‘ã‚’å¤§èƒ†ã«æŠ•è³‡ã«å›ã—ã¾ã—ãŸã€‚é‹å‘½ã®çµæœã¯â€¦",
                money: 0, 
                happiness: 25, 
                type: 'invest'
            },
            B: {
                text: "å®‰å…¨ãªé é‡‘ã¨ã—ã¦æ‰‹å…ƒã«ç½®ã„ã¦ãŠã (ãŠé‡‘Â±0, å¹¸ç¦åº¦Â±0)",
                logText: "å …å®Ÿã«è²¯é‡‘ã‚’ç¶­æŒã—ã¾ã™ã€‚è³‡é‡‘ã¯æ¸›ã‚Šã¾ã›ã‚“ãŒã€å¢—ãˆã‚‚ã—ã¾ã›ã‚“ã€‚",
                money: 0,
                happiness: 0,
            }
        }
    },
    // 13ã‚¿ãƒ¼ãƒ : å®¶æ—ã¨ã®æ™‚é–“ (70-73æ­³)
    {
        startAge: 70,
        description: "è‡ªç”±ã«ä½¿ãˆã‚‹æ™‚é–“ãŒå¢—ãˆã¾ã—ãŸã€‚å®¶æ—ã‚„å‹äººã¨éã”ã—ã¾ã™ã‹ã€ãã‚Œã¨ã‚‚è¶£å‘³ã«æ²¡é ­ã—ã¾ã™ã‹ï¼Ÿ",
        image: 'è€å¾Œ.png', 
        choices: {
            A: {
                text: "å®¶æ—ãƒ»å‹äººã¨æ—…è¡Œã«å‡ºã‹ã‘ã‚‹ (å‡ºè²»â†‘, å¹¸ç¦åº¦â†‘)",
                logText: "æ€ã„å‡ºä½œã‚Šã®ãŸã‚ã€è±ªè¯ãªæ—…è¡Œã«å‡ºã‹ã‘ã¾ã—ãŸã€‚",
                money: -300, 
                happiness: 75, 
            },
            B: {
                text: "æ–°ã—ã„è¶£å‘³ã‚’è¦‹ã¤ã‘ã€ä¸€äººã§æ²¡é ­ã™ã‚‹ (ãŠé‡‘â†“, å¹¸ç¦åº¦â†‘)",
                logText: "é•·å¹´ã®å¤¢ã ã£ãŸè¶£å‘³ã«æ²¡é ­ã€‚å……å®Ÿã—ãŸæ—¥ã€…ã‚’éã”ã—ã¦ã„ã¾ã™ã€‚",
                money: -60, 
                happiness: 50, 
            }
        }
    },
    // 14ã‚¿ãƒ¼ãƒ : æœ€å¾Œã®é¸æŠ (74-77æ­³)
    {
        startAge: 74,
        description: "äººç”Ÿã®çµ‚ç›¤ã§ã™ã€‚ã‚ãªãŸã¯æº€è¶³ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",
        image: 'è€å¾Œ.png', 
        choices: {
            A: {
                text: "ã€Œæœ€é«˜ã®äººç”Ÿã ã£ãŸã€ã¨æŒ¯ã‚Šè¿”ã‚‹ (å¹¸ç¦åº¦â†‘â†‘)",
                logText: "å¾Œæ‚”ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ€é«˜ã®äººç”Ÿã§ã—ãŸã€‚",
                money: 0,
                happiness: 120, 
            },
            B: {
                text: "ã€Œã‚‚ã£ã¨ã“ã†ã™ã‚Œã°è‰¯ã‹ã£ãŸã€ã¨å¾Œæ‚”ã™ã‚‹ (å¹¸ç¦åº¦â†“â†“)",
                logText: "ã‚ã‚Œã“ã‚Œã¨å¾Œæ‚”ãŒæ®‹ã‚Šã¾ã™ã€‚",
                money: 0,
                happiness: -100, 
            }
        }
    },
    // 15ã‚¿ãƒ¼ãƒ : çµ‚ç„‰ (78-81æ­³)
    {
        startAge: 78,
        description: "é™ã‹ã«ã€äººç”Ÿã®æœ€æœŸã‚’è¿ãˆã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚",
        image: 'è€å¾Œ.png', 
        choices: {
            A: {
                text: "å®‰ã‚‰ã‹ã«äººç”Ÿã‚’çµ‚ãˆã‚‹ã€‚",
                logText: "ã‚ãªãŸã®äººç”Ÿã¯ã“ã“ã§å¹•ã‚’é–‰ã˜ã¾ã—ãŸã€‚",
                money: 0,
                happiness: 0,
            },
            B: {
                text: "ã¾ã ã‚„ã‚Šæ®‹ã—ãŸã“ã¨ãŒã‚ã‚‹ã€‚",
                logText: "ã‚‚ã£ã¨ç”ŸããŸã‹ã£ãŸã€‚å¿ƒæ®‹ã‚ŠãŒã‚ã‚Šã¾ã™ã€‚",
                money: 0,
                happiness: -10, 
            }
        }
    },
];

// ----------------------------------------------------
// 2. UIæ“ä½œé–¢æ•°
// ----------------------------------------------------

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã®æ›´æ–°
function updateStatus() {
    document.getElementById('term-value').textContent = gameData.term;
    document.getElementById('age-value').textContent = gameData.age;
    
    // ãŠé‡‘ã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã«ã—ã€è‰²ã‚’å‹•çš„ã«å¤‰æ›´
    const moneyElement = document.getElementById('money-value');
    moneyElement.textContent = gameData.money.toLocaleString();
    moneyElement.classList.remove('positive', 'negative');
    if (gameData.money >= 0) {
        moneyElement.classList.add('positive');
    } else {
        moneyElement.classList.add('negative');
    }

    document.getElementById('happiness-value').textContent = gameData.happiness;
}

// ----------------------------------------------------
// 3. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›¸äº’ä½œç”¨ã«ã‚ˆã‚‹ãƒšãƒŠãƒ«ãƒ†ã‚£é©ç”¨
// ----------------------------------------------------
function applyStatusPenalties() {
    let penaltyMoney = 0;
    let penaltyHappiness = 0;
    let penaltyReportHTML = '';
    
    const moneyBeforePenalty = gameData.money;
    const happinessBeforePenalty = gameData.happiness;

    // 1. ãŠé‡‘ãŒãƒã‚¤ãƒŠã‚¹ã®ã¨ãã®å¹¸ç¦åº¦ãƒšãƒŠãƒ«ãƒ†ã‚£
    if (moneyBeforePenalty < 0) {
        // 1000ä¸‡å††ã”ã¨ã«å¹¸ç¦åº¦ãŒå¤§ããä¸‹ãŒã‚‹
        const tier = Math.floor(Math.abs(moneyBeforePenalty) / 1000) + 1;
        const deduction = tier * 30; // -30pt, -60pt, -90pt...
        
        penaltyHappiness -= deduction;
        penaltyReportHTML += `
            <p style="color:#c62828;">
                **ğŸš¨ çµŒæ¸ˆçš„ã‚¹ãƒˆãƒ¬ã‚¹:** è² å‚µã‚’æŠ±ãˆã¦ã„ã‚‹ãŸã‚ã€ç²¾ç¥çš„è² æ‹…ãŒå¢—å¤§ã—ã¾ã—ãŸã€‚å¹¸ç¦åº¦ **${deduction} pt** æ¸›ã€‚
            </p>
        `;
    }

    // 2. å¹¸ç¦åº¦ãŒä½ã„ã¨ãã®åå…¥ãƒšãƒŠãƒ«ãƒ†ã‚£
    if (!gameData.isRetired && gameData.happiness < 100 && gameData.jobType !== 'None') {
        const incomeLossRate = 0.2; // åå…¥ã®20%ã‚«ãƒƒãƒˆ
        const currentIncome = JOB_INCOME[gameData.jobType] || 0;
        const lossAmount = Math.floor(currentIncome * incomeLossRate);
        
        penaltyMoney -= lossAmount;
        penaltyReportHTML += `
            <p style="color:#c62828;">
                **ğŸ“‰ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹:** å¹¸ç¦åº¦ãŒä½ã„ãŸã‚ã€ä»•äº‹ã®æˆæœãŒæŒ¯ã‚‹ã‚ãšã€ä»Šã‚¿ãƒ¼ãƒ ã®åå…¥ã‹ã‚‰ **${lossAmount.toLocaleString()} ä¸‡å††** ãŒå·®ã—å¼•ã‹ã‚Œã¾ã™ã€‚
            </p>
        `;
    }
    
    // ãƒšãƒŠãƒ«ãƒ†ã‚£ã®é©ç”¨ã¨å ±å‘Š
    if (penaltyMoney !== 0 || penaltyHappiness !== 0) {
        gameData.money += penaltyMoney;
        gameData.happiness += penaltyHappiness;
        
        const totalPenaltyLog = {
            term: gameData.term,
            age: gameData.age,
            choice: 'PENALTY',
            logText: `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›¸äº’ä½œç”¨ã«ã‚ˆã‚‹ãƒšãƒŠãƒ«ãƒ†ã‚£ç™ºç”Ÿã€‚`,
            money: penaltyMoney,
            happiness: penaltyHappiness
        };
        gameData.log.push(totalPenaltyLog);
        
        // å ±å‘Šãƒ‘ãƒãƒ«ã«è¡¨ç¤º
        const penaltyPanel = document.getElementById('status-penalty-report');
        penaltyPanel.innerHTML = `
            <h3>âš ï¸ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é€£é–ãƒšãƒŠãƒ«ãƒ†ã‚£ç™ºç”Ÿï¼</h3>
            ${penaltyReportHTML}
        `;
        penaltyPanel.style.display = 'block';
    } else {
        document.getElementById('status-penalty-report').style.display = 'none';
    }
}


// ----------------------------------------------------
// 4. ã‚¿ãƒ¼ãƒ æƒ…å ±ã¨é¸æŠè‚¢ã®èª­ã¿è¾¼ã¿ (loadTerm)
// ----------------------------------------------------
function loadTerm() {
    // ã‚¿ãƒ¼ãƒ ã®é™ç•Œãƒã‚§ãƒƒã‚¯
    if (gameData.term > terms.length) {
        endGame();
        return; 
    }

    const currentTerm = terms[gameData.term - 1];
    gameData.age = currentTerm.startAge;

    // UIè¦ç´ ã®å–å¾—ã¨ãƒªã‚»ãƒƒãƒˆ
    const termTitle = document.getElementById('term-title');
    const ageText = document.getElementById('age-text');
    const termDescription = document.getElementById('term-description');
    const choicesContainer = document.getElementById('choices-container');
    const resultPanel = document.getElementById('result-panel');
    const nextButton = document.getElementById('next-button');
    const paymentReportPanel = document.getElementById('mandatory-payment-report');
    const careerEventPanel = document.getElementById('random-career-event'); 
    const randomEventPanel = document.getElementById('random-business-school-result'); 
    const termImage = document.getElementById('term-image');

    // UIåˆæœŸåŒ–
    resultPanel.style.display = 'none';
    choicesContainer.innerHTML = '';
    choicesContainer.style.display = 'flex';
    nextButton.style.display = 'none';
    paymentReportPanel.style.display = 'none'; 
    paymentReportPanel.innerHTML = ''; 
    careerEventPanel.style.display = 'none'; 
    careerEventPanel.innerHTML = ''; 
    randomEventPanel.style.display = 'none'; 
    randomEventPanel.innerHTML = ''; 

    // ----------------------------------------------------
    // 3. ãƒšãƒŠãƒ«ãƒ†ã‚£å‡¦ç†ã‚’ã‚¿ãƒ¼ãƒ é–‹å§‹æ™‚ã«å®Ÿè¡Œ
    // ----------------------------------------------------
    applyStatusPenalties();


    // ----------------------------------------------------
    // åå…¥ã‚’åŠ ç®— (è² å‚µã®æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšå®Ÿè¡Œ)
    // ----------------------------------------------------
    let income = 0;
    if (gameData.isRetired) {
        income = JOB_INCOME['Retired']; 
    } else {
        income = JOB_INCOME[gameData.jobType] || 0;
    }
    
    // åå…¥ã‚’ãƒ­ã‚°ã«è¨˜éŒ²
    const incomeLog = {
        term: gameData.term,
        age: gameData.age,
        choice: 'INCOME',
        logText: `åå…¥ï¼ˆ${gameData.isRetired ? 'å¹´é‡‘' : 'çµ¦ä¸'}ï¼‰ã‚’å¾—ã¾ã—ãŸã€‚`,
        money: income,
        happiness: 0
    };
    const debtBeforeIncome = gameData.money;
    gameData.money += income;
    gameData.log.push(incomeLog);
    updateStatus();

    // ----------------------------------------------------
    // è² å‚µå‡¦ç†ã¨å ±å‘Š
    // ----------------------------------------------------
    let debtReportHTML = '';
    const debtAfterIncome = gameData.money;
    
    if (debtBeforeIncome < 0) {
        let interestDeduction = 0;
        let happinessChange = 0;
        
        if (gameData.money >= 0) {
            debtReportHTML = `
                <h3>âœ… è² å‚µå®Œæ¸ˆã®å ±å‘Š (T${gameData.term})</h3>
                <p>
                    å‰ã‚¿ãƒ¼ãƒ ã®åå…¥ã«ã‚ˆã‚Šã€æ®‹ã£ã¦ã„ãŸè² å‚µ **${Math.abs(debtBeforeIncome).toLocaleString()} ä¸‡å††** ã‚’å®Œæ¸ˆã—ã¾ã—ãŸï¼
                </p>
                <p class="final-status" style="color:#1e8e3e; font-weight:bold;">
                    ç¾åœ¨ã®æ®‹é«˜: ${gameData.money.toLocaleString()} ä¸‡å††
                </p>
            `;
            happinessChange = 30; 
            
        } else {
            interestDeduction = Math.floor(debtAfterIncome * 0.1); 
            gameData.money += interestDeduction; 
            gameData.money = Math.round(gameData.money); 

            debtReportHTML = `
                <h3>ğŸš¨ è² å‚µçŠ¶æ³ã®å ±å‘Š (T${gameData.term})</h3>
                <p>
                    åå…¥ã«ã‚ˆã‚Šè² å‚µã®è¿”æ¸ˆãŒè¡Œã‚ã‚Œã¾ã—ãŸãŒã€**åˆ©æ¯ ${Math.abs(interestDeduction).toLocaleString()} ä¸‡å††** ãŒè‡ªå‹•çš„ã«å·®ã—å¼•ã‹ã‚Œã¾ã—ãŸã€‚
                </p>
                <p class="final-status" style="color:#d93025; font-weight:bold;">
                    ç¾åœ¨ã®è² å‚µæ®‹é«˜: ${Math.abs(gameData.money).toLocaleString()} ä¸‡å††
                </p>
            `;
            happinessChange = -15; 
            
            const interestLog = {
                term: gameData.term,
                age: gameData.age,
                choice: 'INTEREST',
                logText: `è² å‚µæ®‹é«˜ã«å¯¾ã™ã‚‹åˆ©æ¯ã‚’æ”¯æ‰•ã„ã¾ã—ãŸã€‚`,
                money: interestDeduction,
                happiness: happinessChange 
            };
            gameData.log.push(interestLog);
        }
        
        gameData.happiness += happinessChange;
    }

    // ----------------------------------------------------
    // è³ƒè²¸å®¶è³ƒã®æ”¯æ‰•ã„ã¨å ±å‘Š
    // ----------------------------------------------------
    let rentReportHTML = '';
    if (gameData.isRenting) {
        const rentAmount = -70;
        const happinessChange = -10;

        gameData.money += rentAmount;
        gameData.happiness += happinessChange;
        
        const rentLog = {
            term: gameData.term,
            age: gameData.age,
            choice: 'RENT',
            logText: `å®¶è³ƒï¼ˆ${Math.abs(rentAmount).toLocaleString()}ä¸‡å††ï¼‰ã‚’æ”¯æ‰•ã„ã¾ã—ãŸã€‚`,
            money: rentAmount,
            happiness: happinessChange 
        };
        gameData.log.push(rentLog);

        rentReportHTML = `
            <h3>ğŸ  å®¶è³ƒæ”¯æ‰•ã„å ±å‘Š (T${gameData.term})</h3>
            <p>
                ä»Šã‚¿ãƒ¼ãƒ ã®å®¶è³ƒ **${Math.abs(rentAmount).toLocaleString()} ä¸‡å††** ã‚’æ”¯æ‰•ã„ã¾ã—ãŸã€‚
            </p>
            <p class="final-status" style="color:#d81b60; font-weight:bold;">
                å¹¸ç¦åº¦ ${Math.abs(happinessChange)} pt æ¸›ã€‚
            </p>
        `;
    }

    // ----------------------------------------------------
    // è² å‚µ/å®¶è³ƒå ±å‘Šãƒ‘ãƒãƒ«ã®è¡¨ç¤º
    // ----------------------------------------------------
    if (debtReportHTML || rentReportHTML) {
        paymentReportPanel.innerHTML = debtReportHTML + rentReportHTML;
        paymentReportPanel.style.display = 'block';
    }


    // ----------------------------------------------------
    // ã‚¿ãƒ¼ãƒ æƒ…å ±ã®æ›´æ–°
    // ----------------------------------------------------
    termTitle.textContent = `ç¬¬${gameData.term}ã‚¿ãƒ¼ãƒ : ${currentTerm.startAge}ã€œ${currentTerm.startAge + 3}æ­³`;
    ageText.textContent = `ç¾åœ¨ã®å¹´é½¢: ${gameData.age}æ­³`;
    termDescription.textContent = currentTerm.description;
    
    if (currentTerm.image) {
        termImage.src = currentTerm.image;
        termImage.style.display = 'block';
    } else {
        termImage.style.display = 'none';
    }

    updateStatus();


    // ----------------------------------------------------
    // é¸æŠè‚¢ã®ç”Ÿæˆ
    // ----------------------------------------------------
    
    let choices = currentTerm.choices;
    
    // ã‚¿ãƒ¼ãƒ 8: çµå©šçŠ¶æ…‹ã«ã‚ˆã£ã¦é¸æŠè‚¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
    if (gameData.term === 8) {
        if (!gameData.isMarried && currentTerm.singleChoices) {
            choices = currentTerm.singleChoices;
            termDescription.textContent = "ã‚ãªãŸã¯ç‹¬èº«ã§ã™ã€‚è‡ªç”±ã«ä½¿ãˆã‚‹ãŠé‡‘ã‚’è‡ªå·±æŠ•è³‡ã‚„è¶£å‘³ã«å……ã¦ã¾ã™ã‹ï¼Ÿ";
        } else if (!gameData.isMarried) {
             // ç‹¬èº«è€…å‘ã‘ã®é¸æŠè‚¢ãŒãªã„å ´åˆã€Bã‚’é¸æŠè‚¢Aã¨ã—ã¦åˆ©ç”¨
             const singleChoiceB = currentTerm.choices.B;
             choices = {
                A: {
                    text: singleChoiceB.text + " (ç‹¬èº«è€…å‘ã‘)",
                    logText: "ï¼ˆç‹¬èº«ï¼‰" + singleChoiceB.logText,
                    money: singleChoiceB.money,
                    happiness: singleChoiceB.happiness,
                },
                B: {
                    text: "ã•ã‚‰ã«ã‚­ãƒ£ãƒªã‚¢ã‚¢ãƒƒãƒ—ã®ãŸã‚ã€é«˜é¡ã‚»ãƒŸãƒŠãƒ¼ã«å‚åŠ ã™ã‚‹ (å‡ºè²»å¤§, åå…¥å¤‰å‹•)",
                    logText: "ï¼ˆç‹¬èº«ï¼‰ã‚­ãƒ£ãƒªã‚¢ã‚¢ãƒƒãƒ—ã®ãŸã‚ã®é«˜é¡ã‚»ãƒŸãƒŠãƒ¼ã«å‚åŠ ã—ã¾ã—ãŸã€‚",
                    money: -300,
                    happiness: 50,
                    type: 'careerSeminar'
                }
             };
             termDescription.textContent = "ã‚ãªãŸã¯ç‹¬èº«ã§ã™ã€‚è‡ªç”±ã«ä½¿ãˆã‚‹ãŠé‡‘ã¨æ™‚é–“ã‚’ã©ã®ã‚ˆã†ã«ä½¿ã„ã¾ã™ã‹ï¼Ÿ";
        }
    }
    
    // ã‚¿ãƒ¼ãƒ 11: ä¿é™ºåŠ å…¥ã®æœ‰ç„¡ã§é¸æŠè‚¢ã‚’èª¿æ•´
    if (gameData.term === 11) {
        if (!gameData.hasInsurance) {
            // ä¿é™ºã«å…¥ã£ã¦ã„ãªã„å ´åˆã€Bã‚’éè¡¨ç¤ºã«ã—ã€Cã‚’Bã¨ã—ã¦æ‰±ã†
            choices = {
                A: currentTerm.choices.A,
                B: currentTerm.choices.C,
            };
        } else {
             // ä¿é™ºã«å…¥ã£ã¦ã„ã‚‹å ´åˆã€Cã‚’éè¡¨ç¤º
            choices = {
                A: currentTerm.choices.A,
                B: currentTerm.choices.B,
            };
        }
    }


    Object.keys(choices).forEach(key => {
        const choice = choices[key];
        const button = document.createElement('button');
        button.className = 'choice-button';
        button.textContent = `${key}: ${choice.text}`;
        button.onclick = () => handleChoice(key, choice);
        choicesContainer.appendChild(button);
    });
}

// ----------------------------------------------------
// 5. é¸æŠè‚¢ã®å‡¦ç† (handleChoice)
// ----------------------------------------------------

function handleChoice(key, choice) {
    // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
    document.querySelectorAll('.choice-button').forEach(btn => btn.disabled = true);

    let resultText = `**${choice.text}** ã‚’é¸æŠã—ã¾ã—ãŸã€‚<br><br>`;
    let moneyChange = choice.money;
    let happinessChange = choice.happiness;
    let logDetail = '';
    
    // ----------------------------------------------------
    // ç‰¹æ®Šãªé¸æŠè‚¢ã®å‡¦ç†
    // ----------------------------------------------------
    if (choice.type === 'job') {
        gameData.jobType = choice.jobType;
        logDetail = `ã‚ãªãŸã®è·ç¨®ã¯ **${choice.jobType === 'Public' ? 'å…¬å‹™å“¡' : 'å¤–è³‡ç³»ä¼æ¥­'}** ã«æ±ºå®šã—ã¾ã—ãŸã€‚`;

    } else if (choice.type === 'businessSchool') {
        // ãƒ“ã‚¸ãƒã‚¹ã‚¹ã‚¯ãƒ¼ãƒ«ã®çµæœã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®š
        if (Math.random() < 0.3) { // 30%ã®ç¢ºç‡ã§å¤§æˆåŠŸ
            moneyChange += 500; 
            happinessChange += 80;
            logDetail = `æŠ•è³‡ãŒå¤§æˆåŠŸï¼ã‚¹ã‚­ãƒ«ãŒå¸‚å ´ã§é«˜ãè©•ä¾¡ã•ã‚Œã€åå…¥ãŒå¤§å¹…ã«ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸã€‚ãŠé‡‘ **+500ä¸‡å††**ã€å¹¸ç¦åº¦ **+80**ã€‚`;
        } else {
            moneyChange += 100; // è²»ç”¨ã®ä¸€éƒ¨ã¯å›å
            happinessChange -= 40;
            logDetail = `æŠ•è³‡ã¯å¤±æ•—ã€‚å­¦è²»ã®ä¸€éƒ¨ã¯å›åã§ãã¾ã—ãŸãŒã€æœŸå¾…ã»ã©ã®æˆæœã¯å¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãŠé‡‘ **+100ä¸‡å††**ã€å¹¸ç¦åº¦ **-40**ã€‚`;
        }
        document.getElementById('random-business-school-result').innerHTML = `
            <h3>ğŸ“š è‡ªå·±æŠ•è³‡ã®çµæœ</h3>
            <p>${logDetail}</p>
        `;
        document.getElementById('random-business-school-result').style.display = 'block';

    } else if (choice.type === 'insurance') {
        gameData.hasInsurance = true;
        logDetail = 'ç·åˆä¿é™ºã«åŠ å…¥ã—ã¾ã—ãŸã€‚å°†æ¥ã®ä¸‡ãŒä¸€ã«å‚™ãˆã‚‰ã‚Œã¾ã™ã€‚';
    
    } else if (choice.type === 'marry') {
        gameData.isMarried = true;
        logDetail = 'çµå©šã—ã¾ã—ãŸã€‚å®¶æ—ã¨ã„ã†å¤§ããªå¹¸ç¦ã®æºã‚’å¾—ã¾ã—ãŸã€‚';

    } else if (choice.type === 'housing') {
        if (choice.housingStatus === 'rent') {
            gameData.isRenting = true;
            logDetail = 'è³ƒè²¸ä½å®…ã«ä½ã¿ç¶šã‘ã€æ¯ã‚¿ãƒ¼ãƒ å®¶è³ƒãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚';
        } else {
            gameData.isRenting = false;
            logDetail = 'ä¸€è»’å®¶ã‚’è³¼å…¥ã€‚ä»Šå¾Œã®å®¶è³ƒè² æ‹…ã¯ãªããªã‚Šã¾ã—ãŸãŒã€å¤§ããªè³‡ç”£å¤‰å‹•ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }

    } else if (choice.type === 'educationInvest' || choice.type === 'careerSeminar') {
        // æ•™è‚²æŠ•è³‡ or ç‹¬èº«è€…ã®ã‚­ãƒ£ãƒªã‚¢æŠ•è³‡
        if (Math.random() < 0.25) { // 25%ã®ç¢ºç‡ã§æˆåŠŸ
            moneyChange += 600; 
            happinessChange += 50;
            logDetail = `æŠ•è³‡ãŒå¤§æˆåŠŸï¼å­ä¾›ã¯åé–€æ ¡ã«å…¥å­¦ï¼ˆã‚ã‚‹ã„ã¯ã‚¹ã‚­ãƒ«ãŒè©•ä¾¡ã•ã‚Œï¼‰å°†æ¥ã®åå…¥ãŒå¤§ããæ”¹å–„ã—ã¾ã—ãŸã€‚ãŠé‡‘ **+600ä¸‡å††**ã€å¹¸ç¦åº¦ **+50**ã€‚`;
        } else {
            moneyChange += 100; // è²»ç”¨ã®ä¸€éƒ¨ã¯å›å
            happinessChange -= 30;
            logDetail = `æŠ•è³‡ã¯æœŸå¾…å¤–ã‚Œã€‚å¤šé¡ã®å‡ºè²»ã‚’ã—ã¾ã—ãŸãŒã€å¤§ããªãƒªã‚¿ãƒ¼ãƒ³ã¯å¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãŠé‡‘ **+100ä¸‡å††**ã€å¹¸ç¦åº¦ **-30**ã€‚`;
        }
        document.getElementById('random-career-event').innerHTML = `
            <h3>ğŸ“ æ•™è‚²/è‡ªå·±æŠ•è³‡ã®çµæœ</h3>
            <p>${logDetail}</p>
        `;
        document.getElementById('random-career-event').style.display = 'block';
    
    } else if (choice.type === 'accident') {
        // äº‹æ•…ã§ä¿é™ºã«å…¥ã£ã¦ã„ãªã„å ´åˆ
        if (gameData.hasInsurance && key === 'B') {
            logDetail = 'ä¿é™ºã‚’é©ç”¨ã€‚è²»ç”¨ã®å¤§åŠã¯ä¿é™ºã§ã‚«ãƒãƒ¼ã•ã‚Œã¾ã—ãŸã€‚';
            // Bã¯ä¿é™ºåŠ å…¥è€…ç”¨ãªã®ã§ãã®ã¾ã¾é©ç”¨
        } else if (!gameData.hasInsurance && key === 'C') {
             // Cã¯éä¿é™ºè€…ç”¨ãªã®ã§ãã®ã¾ã¾é©ç”¨
             logDetail = 'å¼è­·å£«ã«äº¤æ¸‰ã‚’ä¾é ¼ã€‚å¤§ããªå‡ºè²»ã‚’ã—ã¾ã—ãŸãŒã€è‡ªå·±è² æ‹…ã¯æ¸›ã‚Šã¾ã—ãŸã€‚';
        } else if (key === 'A') {
            // Aã¯å…¨æå®³å—ã‘å…¥ã‚Œ
            logDetail = 'ä¿é™ºç­‰ã‚’ä½¿ã‚ãšã€äº‹æ•…ã®æå®³ã‚’å…¨ã¦è‡ªåˆ†ã§è² ã†ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚';
        }

    } else if (choice.type === 'retire') {
        gameData.isRetired = true;
        gameData.jobType = 'Retired';
        logDetail = 'æ—©æœŸé€€è·ã—ã€ç¬¬äºŒã®äººç”ŸãŒã‚¹ã‚¿ãƒ¼ãƒˆã€‚ä»Šå¾Œã¯å¹´é‡‘åå…¥ã¨ãªã‚Šã¾ã™ã€‚';
    
    } else if (choice.type === 'invest') {
        const investmentAmount = Math.floor(gameData.money / 2);
        let returnRate = (Math.random() - 0.5) * 2; // -100%ã‹ã‚‰+100%
        if (returnRate > 0) { // å‹ã£ãŸå ´åˆã€åˆ©ç›Šã‚’æ¸›ã‚‰ã™ï¼ˆæŠ•è³‡ã¯ç”˜ããªã„ï¼‰
            returnRate *= 0.5; // æœ€å¤§+50%
        } else { // è² ã‘ãŸå ´åˆã€æå¤±ã‚’å¢—ã‚„ã™ï¼ˆãƒªã‚¹ã‚¯å¢—ï¼‰
            returnRate *= 1.5; // æœ€å¤§-150%
        }
        
        // æŠ•è³‡é¡ãŒãƒã‚¤ãƒŠã‚¹ã®å ´åˆã¯0ã«
        if (investmentAmount <= 0) {
            logDetail = 'æŠ•è³‡ã™ã‚‹è³‡é‡‘ãŒãªã‹ã£ãŸãŸã‚ã€è¦‹é€ã‚Šã¾ã—ãŸã€‚';
            moneyChange = 0;
            happinessChange = -5; // æŠ•è³‡ã§ããªã‹ã£ãŸã“ã¨ã¸ã®å°ã•ãªå¾Œæ‚”
            document.getElementById('random-career-event').innerHTML = `
                <h3>ğŸ“ˆ æŠ•è³‡ã®çµæœ</h3>
                <p>è³‡é‡‘ä¸è¶³ã®ãŸã‚æŠ•è³‡ã‚’è¦‹é€ã‚Šã¾ã—ãŸã€‚</p>
            `;
            document.getElementById('random-career-event').style.display = 'block';
        } else {
            const investmentReturn = Math.round(investmentAmount * returnRate);
            moneyChange = investmentReturn;
            
            if (investmentReturn > 0) {
                logDetail = `å¤§èƒ†ãªæŠ•è³‡ãŒæˆåŠŸï¼**${investmentReturn.toLocaleString()} ä¸‡å††** ã®åˆ©ç›Šã‚’å¾—ã¾ã—ãŸã€‚`;
                happinessChange += 50;
            } else {
                logDetail = `æŠ•è³‡ãŒå¤§å¤±æ•—ã€‚**${Math.abs(investmentReturn).toLocaleString()} ä¸‡å††** ã®æå¤±ã‚’è¢«ã‚Šã¾ã—ãŸã€‚`;
                happinessChange -= 70;
            }
            
            document.getElementById('random-career-event').innerHTML = `
                <h3>ğŸ“ˆ æŠ•è³‡ã®çµæœ</h3>
                <p>${logDetail}</p>
            `;
            document.getElementById('random-career-event').style.display = 'block';
        }

    }

    // ----------------------------------------------------
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®é©ç”¨
    // ----------------------------------------------------
    gameData.money += moneyChange;
    gameData.happiness += happinessChange;

    // ----------------------------------------------------
    // çµæœãƒ‘ãƒãƒ«ã¨ãƒ­ã‚°ã®è¡¨ç¤º
    // ----------------------------------------------------
    
    const moneyDisplay = moneyChange !== 0 ? 
        `<span style="color:${moneyChange > 0 ? '#1e8e3e' : '#d93025'};">${moneyChange > 0 ? '+' : ''}${moneyChange.toLocaleString()} ä¸‡å††</span>` : 'Â±0 ä¸‡å††';
    const happinessDisplay = happinessChange !== 0 ? 
        `<span style="color:${happinessChange > 0 ? '#f9ab00' : '#d93025'};">${happinessChange > 0 ? '+' : ''}${happinessChange} pt</span>` : 'Â±0 pt';

    document.getElementById('result-text').innerHTML = 
        `${resultText}
        <div class="log-detail">
            **ãŠé‡‘ã®å¤‰å‹•:** ${moneyDisplay} <br>
            **å¹¸ç¦åº¦ã®å¤‰å‹•:** ${happinessDisplay} <br>
            ${logDetail ? `**è©³ç´°:** ${logDetail}` : ''}
        </div>`;
    
    document.getElementById('result-panel').style.display = 'block';
    document.getElementById('choices-container').style.display = 'none';
    document.getElementById('next-button').style.display = 'block';
    
    updateStatus();

    // ãƒ­ã‚°ã«è¨˜éŒ²
    const choiceLog = {
        term: gameData.term,
        age: gameData.age,
        choice: key,
        logText: choice.logText,
        money: moneyChange,
        happiness: happinessChange
    };
    gameData.log.push(choiceLog);
    updateLog();
}

// ----------------------------------------------------
// 6. ãƒ­ã‚°ã¨ã‚²ãƒ¼ãƒ é€²è¡Œ (nextTerm)
// ----------------------------------------------------

function updateLog() {
    const logList = document.getElementById('log-list');
    logList.innerHTML = '';
    
    // ç›´è¿‘ã®ãƒ­ã‚°ã‚’é€†é †ã«5ã¤è¡¨ç¤º
    const recentLogs = gameData.log.slice(-10).reverse();
    
    recentLogs.forEach(entry => {
        const listItem = document.createElement('li');
        let moneyDisplay = entry.money !== 0 ? 
            `<span style="color:${entry.money > 0 ? '#1e8e3e' : '#d93025'};">${entry.money > 0 ? '+' : ''}${entry.money.toLocaleString()}ä¸‡å††</span>` : 'Â±0';
        let happinessDisplay = entry.happiness !== 0 ? 
            `<span style="color:${entry.happiness > 0 ? '#f9ab00' : '#d93025'};">${entry.happiness > 0 ? '+' : ''}${entry.happiness}pt</span>` : 'Â±0';

        listItem.innerHTML = `
            **T${entry.term} (${entry.age}æ­³)**: ${entry.logText} 
            [ãŠé‡‘: ${moneyDisplay}, å¹¸ç¦åº¦: ${happinessDisplay}]
        `;
        logList.appendChild(listItem);
    });
}

function nextTerm() {
    gameData.term++;
    if (gameData.term > terms.length) {
        endGame();
    } else {
        loadTerm();
    }
    
    // â˜…â˜…â˜… ã“ã“ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‡¦ç†ã‚’è¿½åŠ  â˜…â˜…â˜…
    // ãƒšãƒ¼ã‚¸ã®ä¸€ç•ªä¸Šï¼ˆtop: 0ï¼‰ã«ã‚¹ãƒ ãƒ¼ã‚ºã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

// ----------------------------------------------------
// 7. çµ‚äº†å‡¦ç† (endGame)
// ----------------------------------------------------

function endGame() {
    document.getElementById('game-container').style.display = 'none';
    const endGameScreen = document.getElementById('end-game-screen');
    endGameScreen.style.display = 'block';

    const finalMoney = gameData.money;
    const finalHappiness = gameData.happiness;
    
    // ã‚¹ã‚³ã‚¢è¨ˆç®—: (ãŠé‡‘ / 10) * å¹¸ç¦åº¦
    const finalScore = Math.round((finalMoney / 10) * finalHappiness);
    
    document.getElementById('final-money').textContent = finalMoney.toLocaleString();
    document.getElementById('final-happiness').textContent = finalHappiness.toLocaleString();
    document.getElementById('final-score').textContent = finalScore.toLocaleString();
    
    let ratingText = '';
    
    if (finalScore >= 200000) {
        ratingText = "âœ¨ ä¼èª¬ç´šã®äººç”Ÿï¼šæœ€é«˜ã®æˆåŠŸã¨å¹¸ç¦ï¼";
    } else if (finalScore >= 100000) {
        ratingText = "ğŸ† å‹ã¡çµ„ã®äººç”Ÿï¼šè³‡ç”£ã‚‚å¹¸ç¦ã‚‚æ‰‹ã«å…¥ã‚ŒãŸï¼";
    } else if (finalScore >= 40000) {
        ratingText = "âœ… æº€è¶³ã®äººç”Ÿï¼šå¹³å‡ä»¥ä¸Šã«å……å®Ÿã—ãŸæ—¥ã€…ï¼";
    } else if (finalScore >= 0) {
        ratingText = "âš–ï¸ å¹³å‡¡ãªäººç”Ÿï¼šç‰¹ã«çªå‡ºã—ãŸç‚¹ã¯ãªã„ãŒã€å®‰å®šã—ãŸäººç”Ÿã€‚";
    } else {
        ratingText = "ğŸš¨ ç ´æ»…çš„ãªäººç”Ÿï¼šè² å‚µã¨å¾Œæ‚”ãŒæ®‹ã‚‹ã€‚";
    }
    
    document.getElementById('rating').textContent = ratingText;
}


// ----------------------------------------------------
// 8. åˆæœŸåŒ–
// ----------------------------------------------------

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('next-button').addEventListener('click', nextTerm);
    loadTerm();
    updateLog();
});
</script>
</body>
</html>

